version: 2
jobs:
  build:
    branches:
      only: master
    working_directory: ~/app
    docker:
      - image: circleci/node:4.8.2
    steps:
#      - checkout
#      - run:
#          name: install-yarn
#          command: 'sudo npm i -g yarn@latest'
#      - restore_cache:
#          key: dependency-cache-{{ checksum "package.json" }}
#      - run:
#          name: yarn-install
#          command: yarn install
#      - save_cache:
#          key: dependency-cache-{{ checksum "package.json" }}
#          paths:
#            - ./node_modules
#      - run:
#          name: lint
#          command: yarn lint
      - run:
          name: git-pull
          command: ssh -o "StrictHostKeyChecking no" $DROPLET_USER@$DROPLET_IP 'cd /opt/amerikawedding2017/current && git pull && git clean -f -d'
      - run:
          name: yarn-install
          command: ssh -o "StrictHostKeyChecking no" $DROPLET_USER@$DROPLET_IP 'cd /opt/amerikawedding2017/current && yarn'
      - run:
          name: build-prod
          command: ssh -o "StrictHostKeyChecking no" $DROPLET_USER@$DROPLET_IP 'cd /opt/amerikawedding2017/current && yarn build:prod'
      - run:
          name: forever-restart
          command: ssh -o "StrictHostKeyChecking no" $DROPLET_USER@$DROPLET_IP 'cd /opt/amerikawedding2017/current && yarn forever:restart'
